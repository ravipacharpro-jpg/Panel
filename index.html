<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIP NEON PANEL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --blue: #00f3ff; --pink: #ff00ff; --green: #39ff14; --purple: #bc13fe; --bg: #050505; --card: #121212; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* Mobile Header */
        .header { background: #000; padding: 12px; border-bottom: 1px solid var(--blue); text-align: center; }
        .brand-name { font-size: 18px; font-weight: bold; color: var(--blue); text-shadow: 0 0 8px var(--blue); margin: 0; }

        /* Main Scroll Area */
        .main { flex: 1; padding: 15px; overflow-y: auto; padding-bottom: 80px; width: 100%; }
        
        /* Layout Cards */
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #222; margin-bottom: 15px; }
        
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: #111; padding: 10px; border-radius: 10px; text-align: center; border: 1px solid #222; }
        .stat-box h3 { font-size: 10px; color: #777; margin: 0; }
        .stat-box p { font-size: 16px; margin: 5px 0 0; font-weight: bold; color: var(--blue); }

        /* Mobile Bottom Navigation */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; border-top: 1px solid var(--blue); display: flex; justify-content: space-around; padding: 8px 0; z-index: 2000; }
        .nav-item { color: #555; text-align: center; cursor: pointer; flex: 1; display: flex; flex-direction: column; align-items: center; }
        .nav-item i { font-size: 18px; margin-bottom: 3px; }
        .nav-item span { font-size: 10px; }
        .nav-item.active { color: var(--blue); text-shadow: 0 0 10px var(--blue); }

        /* Form Inputs */
        input, select { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: white; border-radius: 8px; font-size: 14px; outline: none; }
        input:focus { border-color: var(--pink); box-shadow: 0 0 8px var(--pink); }
        
        .btn { width: 100%; padding: 14px; background: transparent; border: 2px solid var(--blue); color: var(--blue); cursor: pointer; border-radius: 10px; font-weight: bold; font-size: 13px; text-transform: uppercase; margin-top: 5px; }
        .btn:active { transform: scale(0.98); background: var(--blue); color: #000; }

        /* Scrollable Tables */
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; min-width: 400px; }
        th { text-align: left; color: #555; padding: 8px; border-bottom: 1px solid #333; }
        td { padding: 10px 8px; border-bottom: 1px solid #1a1a1a; }

        /* Status Badges */
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; border: 1px solid; }
        .badge-active { color: var(--green); border-color: var(--green); }

        /* Login Overlay */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        
        .tg-btn { position: fixed; bottom: 75px; right: 15px; width: 45px; height: 45px; background: #0088cc; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 20px; color: white; box-shadow: 0 0 15px #0088cc; z-index: 1500; border: 1.5px solid white; }
        .hidden { display: none !important; }

        @media (min-width: 769px) {
            .nav-bar { width: 240px; height: 100%; flex-direction: column; border-top: none; border-right: 1px solid var(--blue); bottom: auto; }
            body { flex-direction: row; }
            .header { display: none; }
            .main { margin-left: 240px; padding: 30px; }
        }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="card" style="width: 100%; max-width: 320px; text-align: center; border-color: var(--blue);">
            <h2 style="color: var(--blue); margin-bottom: 20px;">VIP LOGIN</h2>
            <input type="text" id="log-user" placeholder="Username">
            <input type="password" id="log-pass" placeholder="Password">
            <button class="btn" onclick="app.login()">ENTER PANEL</button>
        </div>
    </div>

    <div class="header">
        <div id="disp-brand-top" class="brand-name">VIP PANEL</div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="app.tab('dash', this)"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="nav-item" onclick="app.tab('keys', this)"><i class="fas fa-key"></i><span>Keys</span></div>
        <div class="nav-item owner-only hidden" onclick="app.tab('admin', this)"><i class="fas fa-users-cog"></i><span>Staff</span></div>
        <div class="nav-item" onclick="app.tab('settings', this)"><i class="fas fa-cog"></i><span>Setup</span></div>
        <div class="nav-item" onclick="app.logout()" style="color: #ff4444;"><i class="fas fa-power-off"></i><span>Exit</span></div>
    </div>

    <div class="main">
        <div id="tab-dash">
            <h2 style="margin:0 0 10px 0; font-size: 20px;">Hello, <span id="disp-user" style="color: var(--pink);">...</span></h2>
            <div class="stats-grid">
                <div class="stat-box"><h3>Role</h3><p id="disp-role">-</p></div>
                <div class="stat-box"><h3>Keys</h3><p id="disp-keys">0</p></div>
            </div>
            <div class="card" style="border-left: 4px solid var(--green);">
                <p style="font-size: 11px; margin:0; color: #888;">Security Status: Anticheat & Firewall Active ✅</p>
            </div>
        </div>

        <div id="tab-keys" class="hidden">
            <div class="card">
                <h3 style="margin:0 0 10px 0; color: var(--blue); font-size: 16px;">Generate Exact Key</h3>
                <label style="font-size: 10px; color: #555;">Enter Exact Key Name (Case Sensitive)</label>
                <input type="text" id="key-name" placeholder="Ex: RAVI or RAVI-vip">
                
                <label style="font-size: 10px; color: #555;">Device Limit</label>
                <input type="number" id="key-limit" value="1" placeholder="Enter number">
                
                <label style="font-size: 10px; color: #555;">Validity</label>
                <select id="key-time">
                    <option value="5h">5 Hours</option>
                    <option value="1d">1 Day</option>
                    <option value="7d">7 Days</option>
                    <option value="14d">14 Days</option>
                    <option value="30d">30 Days</option>
                    <option value="LIFETIME">Lifetime</option>
                </select>
                
                <div class="owner-admin-only hidden" style="display:flex; align-items:center; gap:8px; margin: 8px 0;">
                    <input type="checkbox" id="key-master" style="width:18px; margin:0;"> 
                    <label style="color: gold; font-size:12px;">Master Key (No Limits)</label>
                </div>
                
                <button class="btn" onclick="app.generateKey()">Create This Key</button>
            </div>

            <div class="card">
                <h3 style="margin:0 0 10px 0; font-size: 14px;">My Keys</h3>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Name/Key</th><th>Limit</th><th>Status</th><th>Action</th></tr></thead>
                        <tbody id="key-list"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-admin" class="hidden">
            <div class="card">
                <h3 style="color: var(--pink); font-size: 16px;">Add Staff</h3>
                <input type="text" id="new-user" placeholder="Username">
                <input type="password" id="new-pass" placeholder="Password">
                <select id="new-role">
                    <option value="admin">Admin</option>
                    <option value="reseller">Reseller</option>
                </select>
                <button class="btn" id="create-btn" onclick="app.createStaff()" style="border-color: var(--pink); color: var(--pink);">Create Account</button>
                <p id="create-status" style="font-size: 11px; margin-top: 10px; color: #888; text-align:center;"></p>
            </div>
        </div>

        <div id="tab-settings" class="hidden">
            <div class="card">
                <h3 style="color: var(--blue); font-size: 16px;">Panel Setup</h3>
                <input type="text" id="set-brand" placeholder="Brand Name">
                <input type="text" id="set-tg" placeholder="Telegram Link">
                <button class="btn" onclick="app.saveSettings()">Save Changes</button>
            </div>
        </div>
    </div>

    <a href="#" id="tg-support" class="tg-btn" target="_blank"><i class="fab fa-telegram-plane"></i></a>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDRpY5f4_SPuuspfed3UkxG99gByr9rqH8",
            authDomain: "host-panel-fd943.firebaseapp.com",
            projectId: "host-panel-fd943",
            storageBucket: "host-panel-fd943.firebasestorage.app",
            messagingSenderId: "75573266168",
            appId: "1:75573266168:web:1db02b2665c4431e495d0d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const app = {
            user: null,
            login: function() {
                const u = document.getElementById('log-user').value.trim();
                const p = document.getElementById('log-pass').value.trim();
                if(!u || !p) return alert("Enter Details");
                auth.signInWithEmailAndPassword(u + "@panel.com", p).catch(e => alert(e.message));
            },
            logout: function() { auth.signOut().then(() => location.reload()); },
            tab: function(t, el) {
                ['dash','keys','admin','settings'].forEach(id => document.getElementById('tab-'+id).classList.add('hidden'));
                document.getElementById('tab-'+t).classList.remove('hidden');
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');
            },
            generateKey: function() {
                const name = document.getElementById('key-name').value; // User jo likhega wahi key hogi
                const limit = document.getElementById('key-limit').value;
                const isMaster = document.getElementById('key-master').checked;
                if(!name || !limit) return alert("Fill Name/Limit");

                // Logic: Jo name dala hai wahi EXACT key hogi
                const key = name; 

                db.collection("keys").add({
                    key: key, customer: name, limit: parseInt(limit),
                    type: isMaster ? "master" : "standard",
                    duration: document.getElementById('key-time').value,
                    adminId: this.user.uid, status: "active", createdAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => { alert("Success! Key: " + key); document.getElementById('key-name').value = ""; });
            },
            createStaff: async function() {
                const user = document.getElementById('new-user').value.trim();
                const pass = document.getElementById('new-pass').value.trim();
                const role = document.getElementById('new-role').value;
                const statusEl = document.getElementById('create-status');
                if(!user || !pass) return alert("Fill fields");
                statusEl.innerText = "Creating...";
                try {
                    const secondaryApp = firebase.initializeApp(firebaseConfig, "Secondary");
                    const secondaryAuth = firebase.auth(secondaryApp);
                    const cred = await secondaryAuth.createUserWithEmailAndPassword(user + "@panel.com", pass);
                    await db.collection("users").doc(cred.user.uid).set({
                        username: user, role: role, status: "active", brandName: "VIP PANEL",
                        createdBy: auth.currentUser.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    await secondaryAuth.signOut(); await secondaryApp.delete();
                    statusEl.innerText = "✅ Created!";
                } catch (e) { statusEl.innerText = "❌ " + e.message; }
            },
            saveSettings: function() {
                const b = document.getElementById('set-brand').value;
                const t = document.getElementById('set-tg').value;
                db.collection("users").doc(this.user.uid).update({ brandName: b, telegram: t }).then(() => alert("Saved!"));
            }
        };

        auth.onAuthStateChanged(async (u) => {
            if (u) {
                app.user = u;
                document.getElementById('login-overlay').style.display = 'none';
                const doc = await db.collection("users").doc(u.uid).get();
                if(doc.exists) {
                    const data = doc.data();
                    document.getElementById('disp-user').innerText = data.username;
                    document.getElementById('disp-role').innerText = data.role.toUpperCase();
                    document.getElementById('disp-brand-top').innerText = data.brandName || "VIP PANEL";
                    if(data.role === 'owner' || data.role === 'admin') {
                        document.querySelectorAll('.owner-admin-only, .owner-only').forEach(e => e.classList.remove('hidden'));
                    }
                    if(data.role === 'owner') document.getElementById('tg-support').href = data.telegram || "#";
                    else {
                        const up = await db.collection("users").doc(data.createdBy || "OWNER").get();
                        document.getElementById('tg-support').href = up.exists ? up.data().telegram : "#";
                    }
                }
                db.collection("keys").where("adminId", "==", u.uid).onSnapshot(snap => {
                    document.getElementById('disp-keys').innerText = snap.size;
                    const list = document.getElementById('key-list'); list.innerHTML = "";
                    snap.forEach(d => {
                        const k = d.data();
                        list.innerHTML += `<tr><td>${k.customer}</td><td style="color:var(--blue)">${k.key}</td><td>${k.limit}</td><td><span class="badge badge-active">Active</span> <i class="fas fa-trash" onclick="db.collection('keys').doc('${d.id}').delete()" style="color:red; margin-left:10px;"></i></td></tr>`;
                    });
                });
            }
        });
    </script>
</body>
</html>
